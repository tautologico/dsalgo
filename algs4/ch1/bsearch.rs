#![feature(test)]

extern crate test;

use test::Bencher;

fn rank(key: i32, a: &[i32]) -> i32 {
    let mut lo = 0;
    let mut hi = a.len() - 1;

    while lo <= hi {
        let mid = lo + (hi - lo) / 2;
        if      key < a[mid]  { hi = mid - 1; }
        else if key > a[mid]  { lo = mid + 1; }
        else                  { return mid as i32;   }
    }
    return -1;
}

fn rank_rec(key: i32, a: &[i32], lo: usize, hi: usize) -> i32 {
    let mid = lo + (hi - lo) / 2;

    if      lo > hi      { -1    }
    else if key < a[mid] { rank_rec(key, a, lo, mid - 1) }
    else if key > a[mid] { rank_rec(key, a, mid + 1, hi) }
    else                 { mid as i32 }
}

fn rank2(key: i32, a: &[i32]) -> i32 {
    rank_rec(key, a, 0, a.len() - 1)
}

#[bench]
fn bench_rank(b: &mut Bencher) {
    let a1 = [146, 1181, 2069, 2309, 2524, 2782, 2853, 3615, 4696, 4929, 6167, 6465, 7020,
              7289, 7376, 7500, 8393, 8518, 8677, 8814, 8954, 9344, 10673, 11920, 12004,    
              12830, 14212, 14232, 14445, 15476, 18383, 18606, 19024, 19051, 19921, 20357,
              20424, 20601, 22017, 22328, 22542, 23031, 23051, 23738, 24095, 24211, 24789,
              24803, 25061, 25298, 26357, 26566, 26685, 26885, 27092, 27210, 29233, 30011,
              31641, 31697, 32729, 32835, 33423, 33428, 33740, 34014, 34286, 34989, 35636,
              36270, 37731, 38117, 38295, 38988, 39039, 39265, 39649, 39970, 40360, 40958,
              41313, 41321, 41376, 41952, 42101, 42168, 43358, 43407, 43450, 43723, 44104,
              44263, 44412, 44720, 44755, 45518, 46278, 46400, 47260, 47513, 47649, 47793,
              48000, 48283, 48500, 49243, 49348, 49835, 50809, 50824, 51197, 52671, 53069,
              53897, 54096, 54367, 55217, 55532, 56438, 56544, 56884, 58355, 58419, 58688,
              58965, 59570, 59811, 60168, 61054, 61461, 61951, 62183, 62401, 62456, 62776,
              63599, 63753, 63883, 63931, 64683, 65136, 65324, 65671, 65791, 66211, 66460,
              67106, 67140, 68207, 68395, 68721, 69347, 69845, 70990, 71423, 73082, 73186,
              73570, 75962, 78370, 79154, 80182, 80439, 81299, 82222, 83268, 85569, 86133,
              86383, 86393, 87088, 87122, 87153, 87768, 88156, 89443, 89892, 90037, 91013,
              91157, 91836, 92026, 92366, 92487, 92869, 93095, 93158, 93212, 93887, 95220,
              95493, 95546, 95571, 95949, 96559, 96731, 97329, 97763, 98678, 99636];

    b.iter(|| rank(1181, &a1));
}

#[bench]
fn bench_rank2(b: &mut Bencher) {
    let a1 = [146, 1181, 2069, 2309, 2524, 2782, 2853, 3615, 4696, 4929, 6167, 6465, 7020,
              7289, 7376, 7500, 8393, 8518, 8677, 8814, 8954, 9344, 10673, 11920, 12004,    
              12830, 14212, 14232, 14445, 15476, 18383, 18606, 19024, 19051, 19921, 20357,
              20424, 20601, 22017, 22328, 22542, 23031, 23051, 23738, 24095, 24211, 24789,
              24803, 25061, 25298, 26357, 26566, 26685, 26885, 27092, 27210, 29233, 30011,
              31641, 31697, 32729, 32835, 33423, 33428, 33740, 34014, 34286, 34989, 35636,
              36270, 37731, 38117, 38295, 38988, 39039, 39265, 39649, 39970, 40360, 40958,
              41313, 41321, 41376, 41952, 42101, 42168, 43358, 43407, 43450, 43723, 44104,
              44263, 44412, 44720, 44755, 45518, 46278, 46400, 47260, 47513, 47649, 47793,
              48000, 48283, 48500, 49243, 49348, 49835, 50809, 50824, 51197, 52671, 53069,
              53897, 54096, 54367, 55217, 55532, 56438, 56544, 56884, 58355, 58419, 58688,
              58965, 59570, 59811, 60168, 61054, 61461, 61951, 62183, 62401, 62456, 62776,
              63599, 63753, 63883, 63931, 64683, 65136, 65324, 65671, 65791, 66211, 66460,
              67106, 67140, 68207, 68395, 68721, 69347, 69845, 70990, 71423, 73082, 73186,
              73570, 75962, 78370, 79154, 80182, 80439, 81299, 82222, 83268, 85569, 86133,
              86383, 86393, 87088, 87122, 87153, 87768, 88156, 89443, 89892, 90037, 91013,
              91157, 91836, 92026, 92366, 92487, 92869, 93095, 93158, 93212, 93887, 95220,
              95493, 95546, 95571, 95949, 96559, 96731, 97329, 97763, 98678, 99636];

    b.iter(|| rank2(1181, &a1));
}

fn main() { 
    let whitelist = [8, 12, 21, 33, 78];

    if rank(12, &whitelist) > 0 {
        println!("Found 12");
    }
    else {
        println!("Did not find 12");
    }

    if rank2(12, &whitelist) > 0 {
        println!("Found 12");
    }
    else {
        println!("Did not find 12");
    }
}
